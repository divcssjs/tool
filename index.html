<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多功能在线工具集 - 一站式开发工具平台</title>
    <meta name="description" content="提供JSON格式化、代码压缩、图片转换、转义工具等多种在线开发工具，一站式解决开发需求">
    <meta name="keywords" content="在线工具,JSON格式化,代码压缩,图片转换,转义工具,开发工具">
    <meta name="google-site-verification" content="hl_i7ZDiuJqV5zQ7AeZLI8zNbLQ6hrLszh2HhgzGins" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            width: 100%;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            text-align: center;
            padding: 30px 20px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }

        nav {
            background: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-link {
            padding: 8px 16px;
            background: #f8f9fa;
            border-radius: 20px;
            text-decoration: none;
            color: #495057;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background: #4a6ee0;
            color: white;
        }

        .modules {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            padding: 30px 0;
        }

        .module {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }

        .module:hover {
            transform: translateY(-5px);
        }

        .full-width {
            grid-column: 1 / -1;
        }

        h2 {
            color: #4a6ee0;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f4ff;
        }

        .input-group,
        .output-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        textarea,
        input[type="file"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            resize: vertical;
            min-height: 150px;
            transition: border 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #4a6ee0;
            box-shadow: 0 0 0 2px rgba(74, 110, 224, 0.2);
        }

        button {
            background: #4a6ee0;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s;
            display: inline-block;
        }

        button:hover {
            background: #3a5ed0;
        }

        .action-group {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .output-group textarea {
            background-color: #f9fafc;
        }

        .hint {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .copy-btn {
            background: #28a745;
        }

        .copy-btn:hover {
            background: #218838;
        }

        .download-btn {
            background: #ff6b6b;
        }

        .download-btn:hover {
            background: #ff5252;
        }

        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 15px;
        }

        .image-container {
            flex: 1;
            min-width: 300px;
            text-align: center;
        }

        .image-container img {
            max-width: 100%;
            max-height: 300px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .image-info {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }

        .quality-control {
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quality-control label {
            margin-bottom: 0;
            min-width: 100px;
        }

        .quality-control input {
            flex: 1;
            margin: 0;
        }

        .quality-value {
            min-width: 40px;
            text-align: center;
        }

        /* 代码对比模块样式 */
        .code-comparison-container {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }

        .code-input-group {
            flex: 1;
        }

        .code-input-group textarea {
            min-height: 250px;
            font-family: "Courier New", monospace;
        }

        .comparison-result {
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }

        .diff-header {
            background: #f8f9fa;
            padding: 10px 15px;
            border-bottom: 1px solid #ddd;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
        }

        .diff-stats {
            font-size: 14px;
            color: #666;
        }

        .diff-content {
            max-height: 400px;
            overflow: auto;
            font-family: "Courier New", monospace;
            font-size: 14px;
            line-height: 1.5;
        }

        .diff-line {
            display: flex;
            padding: 2px 10px;
        }

        .diff-line-number {
            width: 40px;
            text-align: right;
            padding-right: 10px;
            color: #999;
            user-select: none;
        }

        .diff-line-content {
            flex: 1;
            padding-left: 10px;
            border-left: 1px solid #eee;
            white-space: pre-wrap;
        }

        .diff-added {
            background-color: #d4edda;
        }

        .diff-removed {
            background-color: #f8d7da;
        }

        .diff-unchanged {
            background-color: white;
        }

        .diff-empty {
            background-color: #f8f9fa;
        }

        /* HTML实时预览模块样式 */
        .html-preview-container {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }

        .html-input-group {
            flex: 1;
        }

        .html-input-group textarea {
            min-height: 400px;
            font-family: "Courier New", monospace;
        }

        .preview-group {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .preview-frame {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
            min-height: 400px;
        }

        .preview-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .auto-refresh-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.toggle-slider {
            background-color: #4a6ee0;
        }

        input:checked+.toggle-slider:before {
            transform: translateX(26px);
        }

        /* HTML格式化模块样式 */
        .format-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .format-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .format-option label {
            margin-bottom: 0;
            font-weight: normal;
        }

        .format-option input[type="number"] {
            width: 60px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }

        .formatted-code-container {
            position: relative;
        }

        .formatted-code {
            min-height: 400px;
            font-family: "Courier New", monospace;
            white-space: pre;
            overflow-x: auto;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9fafc;
            line-height: 1.4;
        }

        .formatted-code .tag {
            color: #905;
        }

        .formatted-code .attr-name {
            color: #07a;
        }

        .formatted-code .attr-value {
            color: #690;
        }

        .formatted-code .comment {
            color: #999;
            font-style: italic;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 30px 20px;
            color: #666;
            font-size: 14px;
            background: white;
            border-top: 1px solid #eee;
        }

        @media (max-width: 1024px) {
            .modules {
                grid-template-columns: repeat(2, 1fr);
            }

            .full-width {
                grid-column: 1 / -1;
            }
        }

        @media (max-width: 768px) {
            .modules {
                grid-template-columns: 1fr;
            }

            .full-width {
                grid-column: 1;
            }

            .image-container {
                min-width: 100%;
            }

            .code-comparison-container,
            .html-preview-container {
                flex-direction: column;
            }

            .nav-container {
                flex-direction: column;
                align-items: center;
            }

            .nav-link {
                width: 80%;
                text-align: center;
            }

            .format-options {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>多功能在线工具集</h1>
            <p class="subtitle">一站式解决您的开发与内容处理需求 - 提供JSON格式化、代码压缩、图片转换、转义工具等多种实用功能</p>
        </header>

        <nav>
            <div class="nav-container">
                <a href="#js-compress" class="nav-link">JS压缩</a>
                <a href="#css-compress" class="nav-link">CSS压缩</a>
                <a href="#html-compress" class="nav-link">HTML压缩</a>
                <a href="#png-to-jpg" class="nav-link">PNG转JPG</a>
                <a href="#escape" class="nav-link">转义工具</a>
                <a href="#json-format" class="nav-link">JSON格式化</a>
                <a href="#html-format" class="nav-link">HTML格式化</a>
                <a href="#html-preview" class="nav-link">HTML实时预览</a>
                <a href="#code-diff" class="nav-link">代码对比</a>
            </div>
        </nav>

        <div class="modules">
            <!-- JS压缩模块 -->
            <div class="module" id="js-compress">
                <h2>JavaScript压缩</h2>
                <div class="input-group">
                    <label for="js-compress-input">输入JavaScript代码</label>
                    <textarea id="js-compress-input"
                        placeholder="function example() { console.log('Hello World'); }"></textarea>
                    <div class="hint">输入需要压缩的JavaScript代码</div>
                </div>
                <div class="action-group">
                    <button id="js-compress-btn">压缩</button>
                    <button class="copy-btn" data-copy="js-compress-output">复制结果</button>
                </div>
                <div class="output-group">
                    <label for="js-compress-output">压缩结果</label>
                    <textarea id="js-compress-output" readonly></textarea>
                </div>
            </div>

            <!-- CSS压缩模块 -->
            <div class="module" id="css-compress">
                <h2>CSS压缩</h2>
                <div class="input-group">
                    <label for="css-compress-input">输入CSS代码</label>
                    <textarea id="css-compress-input"
                        placeholder="body { font-family: Arial; color: #333; }"></textarea>
                    <div class="hint">输入需要压缩的CSS代码</div>
                </div>
                <div class="action-group">
                    <button id="css-compress-btn">压缩</button>
                    <button class="copy-btn" data-copy="css-compress-output">复制结果</button>
                </div>
                <div class="output-group">
                    <label for="css-compress-output">压缩结果</label>
                    <textarea id="css-compress-output" readonly></textarea>
                </div>
            </div>

            <!-- HTML压缩模块 -->
            <div class="module" id="html-compress">
                <h2>HTML压缩</h2>
                <div class="input-group">
                    <label for="html-compress-input">输入HTML代码</label>
                    <textarea id="html-compress-input" placeholder="<div><p>示例文本</p></div>"></textarea>
                    <div class="hint">输入需要压缩的HTML代码</div>
                </div>
                <div class="action-group">
                    <button id="html-compress-btn">压缩</button>
                    <button class="copy-btn" data-copy="html-compress-output">复制结果</button>
                </div>
                <div class="output-group">
                    <label for="html-compress-output">压缩结果</label>
                    <textarea id="html-compress-output" readonly></textarea>
                </div>
            </div>

            <!-- PNG转JPG模块 -->
            <div class="module" id="png-to-jpg">
                <h2>PNG转JPG</h2>
                <div class="input-group">
                    <label for="png-to-jpg-input">上传PNG图片</label>
                    <input type="file" id="png-to-jpg-input" accept="image/png">
                    <div class="hint">选择PNG格式图片文件</div>

                    <div class="quality-control">
                        <label for="jpg-quality">JPG质量:</label>
                        <input type="range" id="jpg-quality" min="1" max="100" value="90">
                        <span id="quality-value" class="quality-value">90%</span>
                    </div>
                </div>
                <div class="action-group">
                    <button id="png-to-jpg-btn">转换</button>
                    <button id="download-jpg-btn" class="download-btn" disabled>下载JPG</button>
                </div>
                <div class="output-group">
                    <label>转换结果</label>
                    <div id="png-to-jpg-output" class="image-preview"></div>
                </div>
            </div>

            <!-- 转义模块 -->
            <div class="module" id="escape">
                <h2>转义工具</h2>
                <div class="input-group">
                    <label for="escape-input">输入文本</label>
                    <textarea id="escape-input" placeholder='{"name": "示例", "value": 123}'></textarea>
                    <div class="hint">输入需要转义的文本</div>
                </div>
                <div class="action-group">
                    <button id="escape-btn">转义</button>
                    <button class="copy-btn" data-copy="escape-output">复制结果</button>
                </div>
                <div class="output-group">
                    <label for="escape-output">转义结果</label>
                    <textarea id="escape-output" readonly></textarea>
                </div>
            </div>

            <!-- JSON格式化模块 - 全宽 -->
            <div class="module full-width" id="json-format">
                <h2>JSON格式化</h2>
                <div class="input-group">
                    <label for="json-format-input">输入JSON</label>
                    <textarea id="json-format-input" placeholder='{"name": "示例", "value": 123}'></textarea>
                    <div class="hint">输入有效的JSON字符串</div>
                </div>
                <div class="action-group">
                    <button id="json-format-btn">格式化</button>
                    <button class="copy-btn" data-copy="json-format-output">复制结果</button>
                </div>
                <div class="output-group">
                    <label for="json-format-output">格式化结果</label>
                    <textarea id="json-format-output" readonly></textarea>
                </div>
            </div>

            <!-- HTML格式化模块 - 全宽 -->
            <div class="module full-width" id="html-format">
                <h2>HTML格式化</h2>
                <div class="format-options">
                    <div class="format-option">
                        <label for="indent-size">缩进大小:</label>
                        <input type="number" id="indent-size" min="1" max="8" value="2">
                        <span>空格</span>
                    </div>
                    <div class="format-option">
                        <input type="checkbox" id="preserve-empty-lines" checked>
                        <label for="preserve-empty-lines">保留空行</label>
                    </div>
                    <div class="format-option">
                        <input type="checkbox" id="preserve-attributes" checked>
                        <label for="preserve-attributes">保留属性换行</label>
                    </div>
                    <div class="format-option">
                        <input type="checkbox" id="syntax-highlight" checked>
                        <label for="syntax-highlight">语法高亮</label>
                    </div>
                </div>
                <div class="input-group">
                    <label for="html-format-input">输入HTML代码</label>
                    <textarea id="html-format-input" placeholder="<div><p>示例文本</p></div>"></textarea>
                    <div class="hint">输入需要格式化的HTML代码</div>
                </div>
                <div class="action-group">
                    <button id="html-format-btn">格式化</button>
                    <button class="copy-btn" data-copy="html-format-output">复制结果</button>
                </div>
                <div class="output-group">
                    <label for="html-format-output">格式化结果</label>
                    <div class="formatted-code-container">
                        <pre id="html-format-output" class="formatted-code">格式化后的HTML代码将显示在这里</pre>
                    </div>
                </div>
            </div>

            <!-- HTML实时预览模块 - 全宽 -->
            <div class="module full-width" id="html-preview">
                <h2>HTML实时预览</h2>
                <div class="html-preview-container">
                    <div class="html-input-group">
                        <label for="html-preview-input">输入HTML代码</label>
                        <textarea id="html-preview-input" placeholder="<h1>Hello World</h1><p>这是一个示例</p>"></textarea>
                        <div class="hint">输入HTML代码，预览区域将实时更新</div>
                    </div>
                    <div class="preview-group">
                        <label for="html-preview-frame">实时预览</label>
                        <iframe id="html-preview-frame" class="preview-frame"
                            srcdoc="<h1>HTML预览区域</h1><p>请在上方输入HTML代码</p>"></iframe>
                        <div class="preview-controls">
                            <div class="auto-refresh-toggle">
                                <label for="auto-refresh">实时更新</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="auto-refresh" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <button id="manual-refresh-btn">手动刷新</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 代码对比模块 - 全宽 -->
            <div class="module full-width" id="code-diff">
                <h2>代码对比</h2>
                <div class="code-comparison-container">
                    <div class="code-input-group">
                        <label for="original-code">原始代码</label>
                        <textarea id="original-code" placeholder="请输入原始代码..."></textarea>
                    </div>
                    <div class="code-input-group">
                        <label for="modified-code">修改后代码</label>
                        <textarea id="modified-code" placeholder="请输入修改后的代码..."></textarea>
                    </div>
                </div>
                <div class="action-group">
                    <button id="compare-code-btn">对比代码</button>
                    <button id="clear-code-btn" style="background: #6c757d;">清空</button>
                </div>
                <div class="output-group">
                    <label>对比结果</label>
                    <div id="code-diff-output" class="comparison-result">
                        <div class="diff-header">
                            <span>代码差异</span>
                            <span class="diff-stats" id="diff-stats">-</span>
                        </div>
                        <div id="diff-content" class="diff-content">
                            <div class="diff-line diff-empty">
                                <div class="diff-line-number"></div>
                                <div class="diff-line-content">请在上方输入两段代码并点击"对比代码"按钮</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>© 2023 多功能在线工具集 | 设计简洁，功能实用 | 提供JSON格式化、代码压缩、图片转换、转义工具等多种实用功能</p>
        </footer>
    </div>

    <script>
        // 平滑滚动到锚点
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 80,
                        behavior: 'smooth'
                    });
                }
            });
        });

        // 复制功能
        document.querySelectorAll('.copy-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const targetId = btn.getAttribute('data-copy');
                const outputElement = document.getElementById(targetId);

                // 如果是代码区域，需要特殊处理
                if (outputElement.classList.contains('formatted-code')) {
                    const text = outputElement.textContent;
                    navigator.clipboard.writeText(text).then(() => {
                        // 显示复制成功提示
                        const originalText = btn.textContent;
                        btn.textContent = '已复制!';
                        setTimeout(() => {
                            btn.textContent = originalText;
                        }, 1500);
                    });
                } else {
                    // 常规textarea
                    outputElement.select();
                    document.execCommand('copy');

                    // 显示复制成功提示
                    const originalText = btn.textContent;
                    btn.textContent = '已复制!';
                    setTimeout(() => {
                        btn.textContent = originalText;
                    }, 1500);
                }
            });
        });

        // JSON格式化功能
        document.getElementById('json-format-btn').addEventListener('click', () => {
            const input = document.getElementById('json-format-input').value.trim();
            const output = document.getElementById('json-format-output');

            if (!input) {
                output.value = '请输入JSON字符串';
                return;
            }

            try {
                const parsed = JSON.parse(input);
                output.value = JSON.stringify(parsed, null, 2);
            } catch (e) {
                output.value = 'JSON格式错误: ' + e.message;
            }
        });

        // JS压缩功能
        document.getElementById('js-compress-btn').addEventListener('click', () => {
            const input = document.getElementById('js-compress-input').value.trim();
            const output = document.getElementById('js-compress-output');

            if (!input) {
                output.value = '请输入JavaScript代码';
                return;
            }

            // 简单的JS压缩模拟（移除注释和空白）
            let compressed = input
                .replace(/\/\*[\s\S]*?\*\//g, '') // 移除多行注释
                .replace(/\/\/.*/g, '') // 移除单行注释
                .replace(/\s+/g, ' ') // 将多个空白字符替换为一个空格
                .replace(/\s*([{}()\[\];,=+*\/%-])\s*/g, '$1') // 移除运算符周围的空格
                .trim();

            output.value = compressed;
        });

        // CSS压缩功能
        document.getElementById('css-compress-btn').addEventListener('click', () => {
            const input = document.getElementById('css-compress-input').value.trim();
            const output = document.getElementById('css-compress-output');

            if (!input) {
                output.value = '请输入CSS代码';
                return;
            }

            // 简单的CSS压缩模拟
            let compressed = input
                .replace(/\/\*[\s\S]*?\*\//g, '') // 移除注释
                .replace(/\s+/g, ' ') // 将多个空白字符替换为一个空格
                .replace(/\s*([{}:;,])\s*/g, '$1') // 移除选择器和属性周围的空格
                .replace(/;}/g, '}') // 移除最后一个分号
                .trim();

            output.value = compressed;
        });

        // HTML压缩功能
        document.getElementById('html-compress-btn').addEventListener('click', () => {
            const input = document.getElementById('html-compress-input').value.trim();
            const output = document.getElementById('html-compress-output');

            if (!input) {
                output.value = '请输入HTML代码';
                return;
            }

            // 简单的HTML压缩模拟
            let compressed = input
                .replace(/\s+/g, ' ') // 将多个空白字符替换为一个空格
                .replace(/>\s+</g, '><') // 移除标签之间的空格
                .trim();

            output.value = compressed;
        });

        // HTML格式化功能
        document.getElementById('html-format-btn').addEventListener('click', () => {
            const input = document.getElementById('html-format-input').value;
            const output = document.getElementById('html-format-output');
            const indentSize = parseInt(document.getElementById('indent-size').value);
            const preserveEmptyLines = document.getElementById('preserve-empty-lines').checked;
            const preserveAttributes = document.getElementById('preserve-attributes').checked;
            const syntaxHighlight = document.getElementById('syntax-highlight').checked;

            if (!input.trim()) {
                output.textContent = '请输入HTML代码';
                return;
            }

            try {
                const formatted = formatHTML(input, indentSize, preserveEmptyLines, preserveAttributes);

                if (syntaxHighlight) {
                    output.innerHTML = highlightHTML(formatted);
                } else {
                    output.textContent = formatted;
                }
            } catch (e) {
                output.textContent = '格式化错误: ' + e.message;
            }
        });

        // HTML实时预览功能
        const htmlPreviewInput = document.getElementById('html-preview-input');
        const htmlPreviewFrame = document.getElementById('html-preview-frame');
        const autoRefreshToggle = document.getElementById('auto-refresh');
        const manualRefreshBtn = document.getElementById('manual-refresh-btn');

        // 更新预览
        function updatePreview() {
            const htmlContent = htmlPreviewInput.value;
            htmlPreviewFrame.srcdoc = htmlContent || '<p>请输入HTML代码</p>';
        }

        // 自动刷新功能
        htmlPreviewInput.addEventListener('input', () => {
            if (autoRefreshToggle.checked) {
                updatePreview();
            }
        });

        // 手动刷新按钮
        manualRefreshBtn.addEventListener('click', updatePreview);

        // 初始更新一次预览
        updatePreview();

        // PNG转JPG功能
        const pngInput = document.getElementById('png-to-jpg-input');
        const qualitySlider = document.getElementById('jpg-quality');
        const qualityValue = document.getElementById('quality-value');
        const convertBtn = document.getElementById('png-to-jpg-btn');
        const downloadBtn = document.getElementById('download-jpg-btn');
        const outputDiv = document.getElementById('png-to-jpg-output');

        let convertedImageUrl = null;

        // 更新质量显示
        qualitySlider.addEventListener('input', () => {
            qualityValue.textContent = qualitySlider.value + '%';
        });

        // 转换按钮点击事件
        convertBtn.addEventListener('click', () => {
            if (!pngInput.files || !pngInput.files[0]) {
                outputDiv.innerHTML = '<p style="color: red;">请选择PNG图片文件</p>';
                return;
            }

            const file = pngInput.files[0];
            if (file.type !== 'image/png') {
                outputDiv.innerHTML = '<p style="color: red;">请选择PNG格式的图片</p>';
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                const img = new Image();
                img.onload = function () {
                    // 创建Canvas进行转换
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;

                    const ctx = canvas.getContext('2d');

                    // 填充白色背景（PNG透明背景转换为JPG时需要）
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    // 绘制图片
                    ctx.drawImage(img, 0, 0);

                    // 获取JPG数据URL
                    const quality = parseInt(qualitySlider.value) / 100;
                    const jpgDataUrl = canvas.toDataURL('image/jpeg', quality);

                    // 显示结果
                    outputDiv.innerHTML = `
                        <div class="image-container">
                            <h3>原始PNG图片</h3>
                            <img src="${e.target.result}" alt="原始PNG图片">
                            <div class="image-info">
                                尺寸: ${img.width} × ${img.height} 像素<br>
                                文件大小: ${(file.size / 1024).toFixed(2)} KB
                            </div>
                        </div>
                        <div class="image-container">
                            <h3>转换后的JPG图片</h3>
                            <img src="${jpgDataUrl}" alt="转换后的JPG图片">
                            <div class="image-info">
                                尺寸: ${img.width} × ${img.height} 像素<br>
                                质量: ${qualitySlider.value}%
                            </div>
                        </div>
                    `;

                    // 保存转换后的图片URL供下载使用
                    convertedImageUrl = jpgDataUrl;
                    downloadBtn.disabled = false;
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        });

        // 下载按钮点击事件
        downloadBtn.addEventListener('click', () => {
            if (!convertedImageUrl) return;

            // 创建下载链接
            const a = document.createElement('a');
            a.href = convertedImageUrl;
            a.download = 'converted_image.jpg';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        });

        // 转义功能
        document.getElementById('escape-btn').addEventListener('click', () => {
            const input = document.getElementById('escape-input').value.trim();
            const output = document.getElementById('escape-output');

            if (!input) {
                output.value = '请输入需要转义的文本';
                return;
            }

            // 转义处理
            let escaped = input
                .replace(/\\/g, '\\\\')
                .replace(/"/g, '\\"')
                .replace(/'/g, "\\'")
                .replace(/\n/g, '\\n')
                .replace(/\r/g, '\\r')
                .replace(/\t/g, '\\t')
                .replace(/\f/g, '\\f')
                .replace(/\v/g, '\\v');

            output.value = escaped;
        });

        // 代码对比功能
        document.getElementById('compare-code-btn').addEventListener('click', () => {
            const originalCode = document.getElementById('original-code').value;
            const modifiedCode = document.getElementById('modified-code').value;
            const diffContent = document.getElementById('diff-content');
            const diffStats = document.getElementById('diff-stats');

            if (!originalCode && !modifiedCode) {
                diffContent.innerHTML = `
                    <div class="diff-line diff-empty">
                        <div class="diff-line-number"></div>
                        <div class="diff-line-content">请输入需要对比的代码</div>
                    </div>
                `;
                diffStats.textContent = '-';
                return;
            }

            if (originalCode === modifiedCode) {
                diffContent.innerHTML = `
                    <div class="diff-line diff-empty">
                        <div class="diff-line-number"></div>
                        <div class="diff-line-content">两段代码完全相同，没有差异</div>
                    </div>
                `;
                diffStats.textContent = '0 新增, 0 删除';
                return;
            }

            // 计算差异
            const diff = computeDiff(originalCode, modifiedCode);
            renderDiff(diff, diffContent);

            // 更新统计信息
            const added = diff.filter(line => line.type === 'added').length;
            const removed = diff.filter(line => line.type === 'removed').length;
            diffStats.textContent = `${added} 新增, ${removed} 删除`;
        });

        // 清空代码对比
        document.getElementById('clear-code-btn').addEventListener('click', () => {
            document.getElementById('original-code').value = '';
            document.getElementById('modified-code').value = '';
            document.getElementById('diff-content').innerHTML = `
                <div class="diff-line diff-empty">
                    <div class="diff-line-number"></div>
                    <div class="diff-line-content">请在上方输入两段代码并点击"对比代码"按钮</div>
                </div>
            `;
            document.getElementById('diff-stats').textContent = '-';
        });

        // 计算代码差异
        function computeDiff(original, modified) {
            const originalLines = original.split('\n');
            const modifiedLines = modified.split('\n');

            const diff = [];
            let i = 0, j = 0;

            while (i < originalLines.length || j < modifiedLines.length) {
                if (i < originalLines.length && j < modifiedLines.length &&
                    originalLines[i] === modifiedLines[j]) {
                    // 相同的行
                    diff.push({
                        type: 'unchanged',
                        originalLine: i + 1,
                        modifiedLine: j + 1,
                        content: originalLines[i]
                    });
                    i++;
                    j++;
                } else {
                    // 查找删除的行
                    let foundInModified = false;
                    for (let k = j; k < modifiedLines.length; k++) {
                        if (originalLines[i] === modifiedLines[k]) {
                            foundInModified = true;
                            // 添加新增的行
                            for (let l = j; l < k; l++) {
                                diff.push({
                                    type: 'added',
                                    originalLine: null,
                                    modifiedLine: l + 1,
                                    content: modifiedLines[l]
                                });
                            }
                            j = k;
                            break;
                        }
                    }

                    // 查找新增的行
                    let foundInOriginal = false;
                    for (let k = i; k < originalLines.length; k++) {
                        if (originalLines[k] === modifiedLines[j]) {
                            foundInOriginal = true;
                            // 添加删除的行
                            for (let l = i; l < k; l++) {
                                diff.push({
                                    type: 'removed',
                                    originalLine: l + 1,
                                    modifiedLine: null,
                                    content: originalLines[l]
                                });
                            }
                            i = k;
                            break;
                        }
                    }

                    if (!foundInModified && !foundInOriginal) {
                        // 既不是删除也不是新增，可能是修改
                        if (i < originalLines.length) {
                            diff.push({
                                type: 'removed',
                                originalLine: i + 1,
                                modifiedLine: null,
                                content: originalLines[i]
                            });
                            i++;
                        }
                        if (j < modifiedLines.length) {
                            diff.push({
                                type: 'added',
                                originalLine: null,
                                modifiedLine: j + 1,
                                content: modifiedLines[j]
                            });
                            j++;
                        }
                    }
                }
            }

            return diff;
        }

        // 渲染差异结果
        function renderDiff(diff, container) {
            container.innerHTML = '';

            diff.forEach(line => {
                const lineElement = document.createElement('div');
                lineElement.className = `diff-line diff-${line.type}`;

                const lineNumberElement = document.createElement('div');
                lineNumberElement.className = 'diff-line-number';
                lineNumberElement.textContent = line.type === 'added' ? '' : line.originalLine;

                const lineContentElement = document.createElement('div');
                lineContentElement.className = 'diff-line-content';
                lineContentElement.textContent = line.content || ' ';

                if (line.type === 'added') {
                    lineContentElement.innerHTML = `<span style="color: #155724;">+ ${line.content || ' '}</span>`;
                } else if (line.type === 'removed') {
                    lineContentElement.innerHTML = `<span style="color: #721c24;">- ${line.content || ' '}</span>`;
                } else {
                    lineContentElement.innerHTML = `  ${line.content || ' '}`;
                }

                lineElement.appendChild(lineNumberElement);
                lineElement.appendChild(lineContentElement);
                container.appendChild(lineElement);
            });
        }

        // HTML格式化函数
        function formatHTML(html, indentSize = 2, preserveEmptyLines = true, preserveAttributes = true) {
            // 移除多余空白，但保留换行
            html = html.replace(/\s+/g, ' ').replace(/>\s+</g, '><');

            let formatted = '';
            let indent = 0;
            let inTag = false;
            let inComment = false;
            let currentLine = '';

            // 自闭合标签列表
            const selfClosingTags = [
                'area', 'base', 'br', 'col', 'embed', 'hr', 'img',
                'input', 'link', 'meta', 'param', 'source', 'track', 'wbr'
            ];

            // 处理每一行
            const lines = html.split('\n');

            for (let i = 0; i < lines.length; i++) {
                let line = lines[i].trim();
                if (!line && !preserveEmptyLines) continue;

                // 处理注释
                if (line.includes('<!--') && line.includes('-->')) {
                    // 单行注释
                    const indentStr = ' '.repeat(indent * indentSize);
                    formatted += indentStr + line + '\n';
                } else if (line.includes('<!--')) {
                    // 注释开始
                    inComment = true;
                    const indentStr = ' '.repeat(indent * indentSize);
                    formatted += indentStr + line + '\n';
                    indent++;
                } else if (line.includes('-->')) {
                    // 注释结束
                    indent--;
                    const indentStr = ' '.repeat(indent * indentSize);
                    formatted += indentStr + line + '\n';
                    inComment = false;
                } else if (inComment) {
                    // 注释内容
                    const indentStr = ' '.repeat(indent * indentSize);
                    formatted += indentStr + line + '\n';
                } else {
                    // 处理普通HTML
                    const tokens = line.split(/(<[^>]+>)/g);

                    for (let j = 0; j < tokens.length; j++) {
                        let token = tokens[j];
                        if (!token) continue;

                        if (token.startsWith('<')) {
                            // 标签
                            const isClosing = token.startsWith('</');
                            const isSelfClosing = selfClosingTags.some(tag =>
                                token.includes(`<${tag}`) && !token.includes(`</${tag}`)
                            ) || token.endsWith('/>');

                            if (isClosing) {
                                indent--;
                            }

                            const indentStr = ' '.repeat(indent * indentSize);

                            if (preserveAttributes && token.length > 80) {
                                // 长标签，尝试格式化属性
                                const tagMatch = token.match(/^<(\w+)([^>]*)>$/);
                                if (tagMatch) {
                                    const tagName = tagMatch[1];
                                    const attributes = tagMatch[2];

                                    if (attributes.trim()) {
                                        // 分割属性
                                        const attrRegex = /(\s+[^=]+=("[^"]*"|'[^']*'))/g;
                                        let attrs = [];
                                        let match;

                                        while ((match = attrRegex.exec(attributes)) !== null) {
                                            attrs.push(match[1]);
                                        }

                                        if (attrs.length > 0) {
                                            formatted += indentStr + `<${tagName}`;

                                            if (attrs.length === 1) {
                                                formatted += attrs[0] + '>\n';
                                            } else {
                                                formatted += '\n';
                                                for (let k = 0; k < attrs.length; k++) {
                                                    formatted += indentStr + ' '.repeat(indentSize) + attrs[k];
                                                    if (k < attrs.length - 1) formatted += '\n';
                                                }
                                                formatted += '\n' + indentStr + '>\n';
                                            }
                                        } else {
                                            formatted += indentStr + token + '\n';
                                        }
                                    } else {
                                        formatted += indentStr + token + '\n';
                                    }
                                } else {
                                    formatted += indentStr + token + '\n';
                                }
                            } else {
                                formatted += indentStr + token + '\n';
                            }

                            if (!isClosing && !isSelfClosing) {
                                indent++;
                            }
                        } else {
                            // 文本内容
                            if (token.trim()) {
                                const indentStr = ' '.repeat(indent * indentSize);
                                formatted += indentStr + token.trim() + '\n';
                            }
                        }
                    }
                }
            }

            return formatted;
        }

        // HTML语法高亮函数
        function highlightHTML(html) {
            return html
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/(&lt;\/?)(\w+)/g, '$1<span class="tag">$2</span>')
                .replace(/(\s+)(\w+)=/g, '$1<span class="attr-name">$2</span>=')
                .replace(/(=)("[^"]*"|'[^']*')/g, '$1<span class="attr-value">$2</span>')
                .replace(/&lt;!--[\s\S]*?--&gt;/g, '<span class="comment">$&</span>');
        }
    </script>
</body>

</html>
